<!DOCTYPE html>
<!--<html xmlns="http://www.w3.org/1999/html">-->
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=9">
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<title></title>

<link rel="stylesheet" media="screen" href="css/bootstrap.css">

<script language="javascript" type="text/javascript" src="js/yui_config.js"></script>
<script language="javascript" type="text/javascript">
    YUI_setConfig('');
</script>
<script language="javascript" type="text/javascript" src="js/flot/jquery.js"></script>
<!--<script language="javascript" type="text/javascript" src="js/jquery-1.9.1.js"></script>-->
<script language="javascript" type="text/javascript" src="js/jquery-ui-1.10.3.custom.min.js"></script>
<script language="javascript" type="text/javascript" src="js/bootstrap.js"></script>

<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="js/flot/excanvas.min.js"></script><![endif]-->
<script language="javascript" type="text/javascript" src="js/flot/jquery.flot.js"></script>
<script language="javascript" type="text/javascript" src="js/flot/jquery.flot.selection.js"></script>
<script language="javascript" type="text/javascript" src="js/flot/jquery.flot.time.js"></script>
<script language="javascript" type="text/javascript" src="js/flot/jquery.flot.threshold.js"></script>
<!--<script language="javascript" type="text/javascript" src="http://alexb.domain.corp/QvAJAXZfc/htc/QvAjax.js"></script>-->
<!--<script language="javascript" type="text/javascript" src="js/yui/yui/yui.js"></script>-->
<script src="//yui.yahooapis.com/3.11.0/build/yui/yui-min.js"></script>
<style>
<style>


@font-face {
    font-family: "Zero";
    src: url(fonts/Zero-Bold.woff) format('woff');
    font-weight: bold;
}

@font-face {
    font-family: "Zero";
    src: url(fonts/Zero-Bolditalic.woff) format('woff');
    font-weight: bold;
    font-style: italic;
}

@font-face {
    font-family: "Zero";
    src: url(fonts/Zero-Heavy.woff) format('woff');
    font-weight: bolder;
}

@font-face {
    font-family: "Zero";
    src: url(fonts/Zero-heavyItalic.woff) format('woff');
    font-weight: bold;
    font-style: italic;
}

@font-face {
    font-family: "Zero";
    src: url(fonts/Zero-Light.woff) format('woff');
    font-weight: lighter;
}

@font-face {
    font-family: "Zero";
    src: url(fonts/Zero-LightItalic.woff) format('woff');
    font-weight: lighter;
    font-style: italic;
}

@font-face {
    font-family: "Zero";
    src: url(fonts/Zero-Medium.woff) format('woff');
    font-weight: medium;
}

@font-face {
    font-family: "Zero";
    src: url(fonts/Zero-MediumItalic.woff) format('woff');
    font-weight: medium;
    font-style: italic;
}

@font-face {
    font-family: "Zero";
    src: url(fonts/Zero-Regular.woff) format('woff');
    font-weight: normal;
    font-style: normal;
}

@font-face {
    font-family: "Zero";
    src: url(fonts/Zero-RegularItalic.woff) format('woff');
    font-weight: normal;
    font-style: italic;
}

body {
    overflow: hidden;
    margin: 0px;
    padding: 0px;
    border: 0px;
    background-color: black;
    background-image: url("img/bkg.png");
}

#outer_svg {
    position: absolute;
    z-index: 1;
    display: block;
    pointer-events: none;
    margin: 0px;
    padding: 0px;
    border: 0px solid yellow;
    background: black;
}

path {
    stroke: gray;
    stroke-opacity: .25;
    fill: #365F68;
    stroke-width: .5;
}

text {
    fill: gray;
    stroke: none;
    font-family: Zero-Light;
}

    /*
            canvas {
                position: absolute;
                display: block;
                padding: 1px;
                z-index: 100;
                vertical-align: middle;
                text-align: center;
                font-family: Zero-Regular;
                font-size: 1em;
                background: black;
                opacity: 1;
            }
    */

.main-div {
    position: absolute;
    display: block;
    padding: 1px;
    z-index: 100;
    vertical-align: middle;
    text-align: center;
    font-family: Zero-Regular;
    font-size: 1em;
    background: black;
    opacity: 1;
}

::-webkit-input-placeholder {
    color: #999;
}

:-moz-placeholder {
    color: #999;
}

::-moz-placeholder {
    color: #999;
}

:-ms-input-placeholder {
    color: #999;
}

#div_form {
    padding: 2%;
    top: 60%;
    left: 40%;
    color: white;
}

#div_form input {
    position: relative;
    width: 100%;
    padding: 1px;
    font-family: Zero-Regular;
    font-size: 1em;
    background-color: black;
    border: 0px;
    border-bottom: 1px solid gray;
    vertical-align: middle;
}

#div_form input:hover {
    color: white;
    border-bottom: 1px solid white;
}

#div_form input:focus {
    outline: none;
}

#splain {
    position: relative;
    color: white;
    font-size: .5em;
    text-align: left;
}

.dots {
    border: 1px dashed #00D1FA;
}

#fog {
    background: black;
    opacity: .5;
    z-index: 50;
    width: 100%;
    height: 100%;
    top: 0px;
    left: 0px;
}

.QvInlineObject {
    position: relative;
    margin-left: 10px;
    margin-right: 10px;
    float: left;
}

.demo-placeholder {
    width: 100%;
    height: 100%;
    font-size: 14px;
    line-height: 1.2em;
}

.legend table {
    border-spacing: 5px;
}

.flot-tick-label .tickLabel {
    font-size: 14px;
    color: #ffffff;
}

.yAxis .xAxis {
    font-size: 14px;
    color: #ffffff;
}
</style>
</head>
<body>
<div id="page">
    <div id="menu" style="display: none">

    </div>
    <div id="body">
    </div>
</div>

<!--<div id="qv_01" class="QvInlineObject" avqview="zero-white.qvw" avq="object:.Document\CS01" id="Document\CS01"-->
     <!--style="height: 250px; width: 300px;display: none;"></div>-->
<!--<div id="qv_04" class="QvInlineObject" avqview="zero-white.qvw" avq="object:.Document\LB01" id="Document\LB01"-->
     <!--style="height: 250px; width: 300px;display: none;"></div>-->
<!--<div id="qv_05" class="QvInlineObject" avqview="zero-white.qvw" avq="object:.Document\LB03" id="Document\LB03"-->
     <!--style="height: 250px; width: 300px;display: none;"></div>-->
<!--<div id="qv_02" class="QvInlineObject" avqview="zero-white.qvw" avq="object:.Document\CH01" id="Document\CH01"-->
     <!--style="height: 200px; width: 450px;display: none;"></div>-->
<!--<div id="qv_03" class="QvInlineObject" avqview="zero-white.qvw" avq="object:.Document\CH04" id="Document\CH04"-->
     <!--style="height: 250px; width: 300px;display: none;"></div>-->
<!--<div id="qv_06" class="QvInlineObject" avqview="zero-white.qvw" avq="object:.Document\SH01" id="Document\SH01"-->
     <!--style="height: 350px; width: 400px;display: none;"></div>-->
</body>

<script language="javascript" type="text/javascript">
    YUI().use('vader-app', function (Y) {
        new Y.Vader.App({
            serverRouting: false,
            transitions: true
        }).render().dispatch();
    });
    $(function () {
        $.noConflict(true);
//        $plot = jQuery.plot;
    });
</script>
<script id="t-welcome" type="text/x-template">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="100%"
         height="100%" viewBox="0 0 800 600" preserveAspectRatio="xMidYMid" id="outer_svg">
        <!--
            <line x1="50%" y1="0" x2="50%" y2="100%" stroke="green" />
            <line x1="0" y1="50%" x2="100%" y2="50%" stroke="green" />
        -->
        <g id="center_g">
            <g id="hsa">
                <text text-anchor="middle" x="50%" y="20%" style="font-size: 100" id="human">human</text>
                <text text-anchor="middle" x="50%" y="35%" style="font-size: 100" id="simple">simple</text>
                <text text-anchor="middle" x="50%" y="50%" style="font-size: 100" id="authentic">authentic</text>
            </g>
            <g id="logo">
                <image width="212" height="44" x="50%" y="60%" transform="translate(-106, -22)"
                       xlink:href="img/zero_logo.png"></image>
            </g>
            <g id="other_text">
                <g id="wea">
                    <text text-anchor="middle" x="50%" y="75%" style="font-size: 25">Want Early Access?</text>
                    <text text-anchor="middle" x="50%" y="80%" style="font-size: 20">log in</text>
                    <image width="40" height="30" x="50%" y="75%" transform="translate(-15, 10)" id="login_btn"
                           xlink:href="img/1x1.png" pointer-events="all"></image>
                </g>
                <g id="logins">
                    <image width="30" height="31" x="50%" y="85%" transform="translate(-80, 0)"
                           xlink:href="img/facebook.png"></image>
                    <image width="30" height="33" x="50%" y="85%" transform="translate(-15, 0)"
                           xlink:href="img/googleplus.png"></image>
                    <image width="30" height="31" x="50%" y="85%" transform="translate(50, 0)"
                           xlink:href="img/mail.png" id="show_form_btn" pointer-events="all"/>
                </g>
                <g id="dontworry">
                    <text text-anchor="middle" x="50%" y="93%" style="font-size: 12">It's fast and easy. We promise
                        never to
                    </text>
                    <text text-anchor="middle" x="50%" y="95%" style="font-size: 12">post anything without your
                        permission.
                    </text>
                </g>
            </g>
        </g>
        <svg id="inner_svg">
            <g id="pies"></g>
        </svg>
        <defs id="defs">
            <radialGradient id="rad_grad">
                <stop offset="80%" stop-color="black" stop-opacity="0"/>
                <stop offset="110%" stop-color="black" stop-opacity="1"/>
            </radialGradient>
        </defs>
        <rect width="100%" height="100%" x="0" y="0" fill="url(#rad_grad)"/>
    </svg>
    <div id="fog" class="main-div"></div>
    <div id="div_form" class="dots main-div">
        <form id="email_form" method="post">
            <input type="text" placeholder="your@email.com" name="email" id="email_input">
        </form>
        <div id="splain" class="main-div">&nbsp;</div>
    </div>
    <div id="div_thanks" class="dots main-div">Thanks! We'll be in touch.</div>
    <div id="main" class="main-div"></div>
</script>
<script language="javascript" type="text/javascript">
// globals
var w = 800, // viewport
        h = 600, // vewport
        NS = "http://www.w3.org/2000/svg",
        origin_count = 3, // # of pie centers
        slices_count = 9, // # of slices per pie
        pies = [],
        velos = [];

// form stuff
var $form = $("#div_form");
var $input = $("#email_input");
var $fog = $("#fog");
var $thx = $("#div_thanks");
var $splain = $("#splain");
var FADE = 600;
var DELAY = 3000;

var animateID = 0;

/*
 // hide everything when doc loads
 $(document).ready(function(){
 $fog.hide();
 $form.hide();
 $thx.hide();
 });

 // show the form when the button is clicked
 // tough to select the SVG element directly, so grab it first, then stick it in jquery context; clever, no? ;)
 var button = document.getElementById("show_form_btn");
 $(button).click( function(){
 $fog.fadeIn(FADE);
 $form.fadeIn(FADE);
 });
 // ok now
 $input.focus( function() {
 $splain.text(" (Hit return to submit)");
 });

 // hide form, show thx
 // then clear it all
 $form.submit( function(event){
 event.preventDefault();
 var fw = $form.width();
 var fh = $form.height();
 $form.fadeOut(100, function() {
 $(this).text("Thanks. We'll be in touch.").fadeIn(100).delay(DELAY).fadeOut(FADE);
 $form.width( fw );
 $form.height( fh );
 $form.delay(DELAY).fadeOut(FADE);
 $fog.delay(DELAY).fadeOut(FADE);
 });
 });

 // hide the form if click out anywhere else
 $fog.click( function(){
 $fog.fadeOut(FADE);
 $form.fadeOut(FADE);
 $thx.fadeOut(FADE);
 });


 // animate
 // start with random velocities
 var velos = [];
 for ( i = 0; i < pies.length; i++ ) {
 velos[i] = new Vect( rnd_bmt() );
 }
 */


function stopAnimation() {
    clearInterval(animateID);
}

function animate(pies) {
    function frame() {
        for (i = 0; i < pies.length; i++) {
            // bounce off the walls
            if (pies[i].origin.x <= 0 || pies[i].origin.x >= w) {
                velos[i].x *= -1;
            }
            if (pies[i].origin.y <= 0 || pies[i].origin.y >= h) {
                velos[i].y *= -1;
            }

            pies[i].origin.add(velos[i]);
            pies[i].draw();
        }
    }

    animateID = setInterval(frame, 10) // draw every 10ms
}

//***** Vector *****//
function Vect(p) {
    this.x = p.x;
    this.y = p.y;

    this.mag = function () {
        return Math.sqrt(this.x * this.x + this.y * this.y);
    };

    this.heading = function () {
        return Math.tan(y / x);
    };
}

//***** Point *****//
function Point(x, y) {
    this.x = x;
    this.y = y;

    this.add = function (pt) {
        this.x += pt.x;
        this.y += pt.y;
    };
    this.sub = function (pt) {
        this.x -= pt.x;
        this.y -= pt.y;
    };
    this.mult = function (n) {
        this.x *= n;
        this.y *= n;
    };
    this.div = function (n) {
        this.x /= n;
        this.y /= n;
    }
}

//***** Slice *****//
function Slice(origin, point1, point2) {
    this.o = origin;
    this.p1 = point1;
    this.p2 = point2;
}

//***** Pie *****//
function Pie(origin, slices_count, id) {
    this.origin = origin;
    this.id = id;
    this.slices = [];

    // make slices
    var total_angle = 0;
    var point1 = get_offscreen_point(origin, total_angle);
    var start_point = point1;


    for (var i = 0; i < slices_count; i++) {
        var angle = get_random_angle(slices_count);
        total_angle += ( ( total_angle + angle ) >= 2 * Math.PI ) ? 0 : angle;
        var point2 = get_offscreen_point(origin, total_angle);

        // close it if last slice
        if (i == slices_count - 1) {
            point2 = start_point;
        }
        this.slices.push(new Slice(origin, point1, point2));
        point1 = point2;
    }

    // update the origin and slices
    this.setOrigin = function (new_origin) {
        this.origin = new_origin;

        for (var i = 0; i < this.slices.length; i++) {
            this.slices[i].o = this.origin;
        }
    };

    this.draw = function () {
        var parent = document.getElementById("pies");
        if (!parent) return;
        var defs = document.getElementById("defs");

        // if it no exist, create it!
        var pie_node = document.getElementById(this.id);
        if (pie_node == null) {
            pie_node = document.createElementNS(NS, "g");
            pie_node.setAttribute("id", this.id);
            parent.appendChild(pie_node);
        }

        for (var i = 0; i < this.slices.length; i++) {

            // make or update path in defs
            var id = this.id + "_path_" + i;
            // get or create path
            var is_new = false;
            var path = document.getElementById(id);
            if (path == null) {
                path = document.createElementNS(NS, "path");
                path.setAttribute("id", id);
                defs.appendChild(path);
                is_new = true;
            }

            // path data
            var d =
                    "M" + Math.round(this.slices[i].o.x) + ", " + Math.round(this.slices[i].o.y) +
                            "L" + Math.round(this.slices[i].p1.x) + ", " + Math.round(this.slices[i].p1.y) +
                            "L" + Math.round(this.slices[i].p2.x) + ", " + Math.round(this.slices[i].p2.y) +
                            "Z";
            path.setAttribute("d", d);

            // randomly opaque if new
            if (is_new) {
                var fill_opacity = Math.random() * .25;
                path.setAttribute("fill-opacity", fill_opacity);
//				path.setAttribute("start_fill-opacity",fill_opacity);
            }

            // make or update use
            var use = document.getElementById("use_" + id);
            if (use == null) {
                use = document.createElementNS(NS, "use");
                pie_node.appendChild(use);
            }
            use.setAttribute("id", "use_" + id);
            use.setAttributeNS("http://www.w3.org/1999/xlink", "href", "#" + id);
        }
    }
}
//***** UTILITIES *****//

// given a number of pie slices
// return a random but not too random slice theta
function get_random_angle(c) {
    return 2 * Math.PI / c * ( Math.random() + .5 );
}

// given an origin and an angle
// return a point that is definitely off-screen
function get_offscreen_point(origin, angle) {
    var w = window.innerWidth;
    var h = window.innerHeight;
    var radius = Math.sqrt(w * w + h * h); // x^2 + y^2 = z^2
    return new Point(origin.x + Math.cos(angle) * radius, origin.y + Math.sin(angle) * radius);
}

//Box-Muller transform for standard normal distribution random numbers
function rnd_bmt() {
    var x = 0, y = 0, rds, c;

    // Get two random numbers from -1 to 1.
    // If the radius is zero or greater than 1, throw them out and pick two new ones
    // Rejection sampling throws away about 20% of the pairs.
    do {
        x = Math.random() * 2 - 1;
        y = Math.random() * 2 - 1;
        rds = x * x + y * y;
    }
    while (rds == 0 || rds > 1)

    // This magic is the Box-Muller Transform
    c = Math.sqrt(-2 * Math.log(rds) / rds);

    // It always creates a pair of numbers. I'll return them in an array.
    // This function is quite efficient so don't be afraid to throw one away if you don't need both.
    return new Point(x * c, y * c);
}

function rdm(n) {
    var sign = Math.random() < .5 ? -1 : 1;
    return sign * Math.random() * n;
}

/***************************************************************************/

var graphData = null;
function getData(x1, x2) {

    var dataLength = graphData.length - 1;

    if (!x1) {
        x1 = graphData[dataLength-12*25].time;
    }
    if (!x2) {
        x2 = graphData[dataLength].time;
    }

    var dataHR = [];
    var dataDS = [];
    var dataLS = [];
    var dataStp = [];
    var dataHyd = [];
    var dataStress = [];
    var calEvent = [];
    var ymin = -10, ymax = 0;
    for (var i = 0; i <= dataLength; ++i) {
        var measurement = graphData[i];
        if (x1 > measurement.time || x2 < measurement.time) continue;


        dataHR.push([measurement.time, measurement.heartRate]);
        dataStp.push([measurement.time, measurement.steps]);
        dataDS.push([measurement.time, measurement.deepSleep ? 100 : 0]);
        dataLS.push([measurement.time, measurement.lightSleep? 60 : 0]);
        dataHyd.push([measurement.time, measurement.hydration]);
        dataStress.push([measurement.time, measurement.stress]);
        calEvent.push([measurement.time, (measurement.cEvent?-10:0)]);
        ymin = Math.min(ymin,measurement.heartRate,measurement.steps,measurement.hydration,measurement.stress);
        ymax = Math.max(ymax,measurement.heartRate,measurement.steps,measurement.hydration,measurement.stress);
//        if (ymin > minval) {
//            ymin = minval
//        }
//        if (ymax < maxval) {
//            ymax = maxval
//        }
    }

    return {
        xaxis: {min: x1, max: x2},
        yaxis: {min: ymin, max: ymax},
        data: [
            {
                label: "deep sleep",
                color: '#9090FF',
                data: dataDS,
                lines: {
                    show: true
                    ,fill: true
                    ,steps: true
                }
            },
            {
                label: "light sleep",
                color: '#BBBBFF',
                data: dataLS,
                lines: {
                    show: true
                    ,fill: true
                    ,steps: true
                }
            },
            {
                label: "calendar event",
                color: '#BBFFBB',
                data: calEvent,
                lines: {
                    show: true
                    ,fill: true
                    ,steps: true
                }
            },
            {
                label: "heart rate",
                data: dataHR,
                color: '#FF5050',
                lines: { show: true },
                points: { show: false }
            },
            {
                label: "steps",
                data: dataStp,
                color: '#50FF50',
                lines: { show: true },
                points: { show: false }
            },
            {
                label: "hydration",
                data: dataHyd,
                color: '#FF0000',
                lines: { show: true },
                threshold: [
                    {
                    below: 45
                    ,color: '#FF0000'
                },
                    {
                        below: 55
                        ,color: '#e5960c'
                    },
                    {
                        below: 65
                        ,color: '#00FF00'
                    },
                    {
                    below: 70
                    ,color: '#e5960c'
                }],

                points: { show: false }
            },
            {
                label: "stress",
                data: dataStress,
                threshold: [{
                    below: 25
                    ,color: '#00FF00'
                },{
                    below: 50
                    ,color: '#e5960c'
                }],

                color: '#FF0000',
                lines: { show: true },
                points: { show: false }
            }
        ]
    };
}
function getOverviewData() {

    var dataLength = graphData.length - 1;
    var d = [];
    var calEvent = [];
    var ymin = 0, ymax = 0;
    for (var i = 0; i <= dataLength; ++i) {
        var measurement = graphData[i];
        //var x = x1 + i * (x2 - x1) / 100;
        d.push([measurement.time, measurement.heartRate]);
        calEvent.push([measurement.time, (measurement.cEvent?20:0)]);
        ymin = Math.min(ymin,measurement.heartRate,measurement.cEvent);
        ymax = Math.max(ymax,measurement.heartRate,measurement.cEvent);
    }

    return {
        xaxis: {min: graphData[0].time, max: graphData[dataLength].time},
        yaxis: {min: ymin, max: ymax},
        data: [
            { label: "heart rate", data: d },
            {
                label: "calendar event",
                color: '#BBFFBB',
                data: calEvent,
                lines: {
                    show: true
                    ,fill: true
                    ,steps: true
                }
            }
        ]
    };
}

/*
function ShowJsGraph(userId) {
    $.ajax({
        url: '/api/' + userId + '/data.json?' + Math.random() * 1000,
        type: "GET",
        dataType: "json",
        success: onJsGraphDataLoad
    });
}
*/

function onJsGraphDataLoad(series) {
    graphData = series;
    var startData = getData();
    var options = {
        legend: {
            show: true
        },
//        series: {
//            lines: {
//                show: true
//            },
//            points: {
//                show: false
//            }
//        },
        xaxis: {
            mode: "time",
            min: startData.xaxis.min,
            max: startData.xaxis.max,
            ticks: 10
        },
        yaxis: {
            min: startData.yaxis.min,
            max: 160, //startData.yaxis.max,
            ticks: 10
        },
        grid: {
            backgroundColor: { colors: [ "#fff", "#eee" ] },
            borderWidth: {
                top: 1,
                right: 1,
                bottom: 2,
                left: 2
            }
        },
        selection: {
            mode: "x"
        }
    };
    var plot = $.plot('#placeholder', startData.data, options);
    var overviewData = getOverviewData();
    var overview = $.plot("#overview", overviewData.data, {
        legend: {
            show: false
        },
        series: {
            lines: {
                show: true,
                lineWidth: 1
            },
            shadowSize: 0
        },
        xaxis: {
            mode: "time",
            min: overviewData.xaxis.min,
            max: overviewData.xaxis.max,
            ticks: 15
        },
        yaxis: {
            min: overviewData.yaxis.min,
            max: overviewData.yaxis.max,
            ticks: 3
//          ,  min: -2,
//            max: 2
        },
        grid: {
            color: "#999"
        },
        selection: {
            mode: "x"
        }
    });
    overview.setSelection({xaxis:{from:startData.xaxis.min, to:startData.xaxis.max},yaxis:{from:overviewData.yaxis.min, to:overviewData.yaxis.max}}, true);


    $("#placeholder").bind("plotselected", function (event, ranges) {

        // clamp the zooming to prevent eternal zoom

        if (ranges.xaxis.to - ranges.xaxis.from < 50) {
            ranges.xaxis.to = ranges.xaxis.from + 50;
        }

        if (ranges.yaxis.to - ranges.yaxis.from < 10) {
            ranges.yaxis.to = ranges.yaxis.from + 10;
        }

        // do the zooming

        plot = $.plot("#placeholder", getData(ranges.xaxis.from, ranges.xaxis.to).data,
                $.extend(true, {}, options, {
                    xaxis: { min: ranges.xaxis.from, max: ranges.xaxis.to },
                    yaxis: { min: ranges.yaxis.from, max: ranges.yaxis.to }
                })
        );

        // don't fire event on the overview to prevent eternal loop

        overview.setSelection(ranges, true);
    });

    $("#overview").bind("plotselected", function (event, ranges) {
        plot.setSelection(ranges, false);
    });

}

</script>
</html>